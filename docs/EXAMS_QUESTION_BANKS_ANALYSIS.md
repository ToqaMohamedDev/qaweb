# ุชุญููู ุฌุฏุงูู ุจูู ุงูุฃุณุฆูุฉ ูุงูุงูุชุญุงูุงุช
## Database Tables Analysis - Question Banks & Exams

---

## ๐ ููุฎุต ุงูุฌุฏุงูู

| ุงูุฌุฏูู | ุงููุตู | ุงูููุน |
|--------|-------|-------|
| `question_banks` | ุจูู ุงูุฃุณุฆูุฉ | ุฃุณุฆูุฉ |
| `quiz_questions` | ุฃุณุฆูุฉ ุงููููุฒ ูุงูุฃูุนุงุจ | ุฃุณุฆูุฉ |
| `teacher_exams` | ุงูุชุญุงูุงุช ุงููุฏุฑุณ | ุงูุชุญุงูุงุช |
| `teacher_exam_attempts` | ูุญุงููุงุช ุงูุทุงูุจ ูู ุงูุชุญุงูุงุช ุงููุฏุฑุณ | ุฅุฌุงุจุงุช |
| `comprehensive_exams` | ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ (ุงูุชุญุงูุงุช ุงููููุน) | ุงูุชุญุงูุงุช |
| `comprehensive_exam_attempts` | ูุญุงููุงุช ุงูุทุงูุจ ูู ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ | ุฅุฌุงุจุงุช |

---

## 1. ุฌุฏูู `question_banks` - ุจูู ุงูุฃุณุฆูุฉ

### ุงููุตู
ุฌุฏูู ุจููู ุงูุฃุณุฆูุฉ - ูู ุตู ููุซู ุจูู ุฃุณุฆูุฉ ูุงูู ูุฑุชุจุท ุจุฏุฑุณ ูุนูู

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `lesson_id` | uuid | ูุนุฑู ุงูุฏุฑุณ ุงููุฑุชุจุท | โ | - |
| `stage_id` | uuid | ูุนุฑู ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ | โ | - |
| `subject_id` | uuid | ูุนุฑู ุงููุงุฏุฉ | โ | - |
| `title` | jsonb | ุนููุงู ุงูุจูู (ูุชุนุฏุฏ ุงููุบุงุช) | โ | `'{"ar": "", "en": ""}'` |
| `description` | jsonb | ูุตู ุงูุจูู (ูุชุนุฏุฏ ุงููุบุงุช) | โ | - |
| `sections` | jsonb | ุฃูุณุงู ุงูุฃุณุฆูุฉ | โ | `'[]'` |
| `settings` | jsonb | ุฅุนุฏุงุฏุงุช ุงูุจูู | โ | `'{}'` |
| `is_published` | boolean | ูู ููุดูุฑ | โ | `false` |
| `created_by` | uuid | ูุนุฑู ุงูููุดุฆ | โ | - |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
question_banks.lesson_id โ lessons.id
question_banks.stage_id โ educational_stages.id
question_banks.subject_id โ subjects.id
question_banks.created_by โ profiles.id
```

### ูููู `sections` (JSONB)

```json
[
  {
    "id": "uuid",
    "title": { "ar": "ุงููุณู ุงูุฃูู", "en": "Section 1" },
    "questions": [
      {
        "id": "uuid",
        "type": "multiple_choice | true_false | fill_blank | matching | ordering | essay",
        "text": { "ar": "ูุต ุงูุณุคุงู", "en": "Question text" },
        "options": [
          { "id": "uuid", "text": { "ar": "", "en": "" }, "isCorrect": true }
        ],
        "correctAnswer": "...",
        "points": 1,
        "explanation": { "ar": "", "en": "" }
      }
    ]
  }
]
```

---

## 2. ุฌุฏูู `quiz_questions` - ุฃุณุฆูุฉ ุงููููุฒ

### ุงููุตู
ุฃุณุฆูุฉ ุงููููุฒ ููุฏุฑูุณ ููุถุน ุงููุนุจ - ูููู ุฃู ุชููู ูุฑุชุจุทุฉ ุจุฏุฑุณ ุฃู ูุณุชููุฉ

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `lesson_id` | uuid | ูุนุฑู ุงูุฏุฑุณ (ุงุฎุชูุงุฑู ููุฃุณุฆูุฉ ุงููุณุชููุฉ) | โ | - |
| `created_by` | uuid | ูุนุฑู ุงูููุดุฆ | โ | - |
| `text` | jsonb | ูุต ุงูุณุคุงู (ูุชุนุฏุฏ ุงููุบุงุช) | โ | `'{"ar": "", "en": ""}'` |
| `type` | text | ููุน ุงูุณุคุงู | โ | `'multiple_choice'` |
| `options` | jsonb | ุงูุฎูุงุฑุงุช | โ | `'[]'` |
| `correct_answer` | jsonb | ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ | โ | - |
| `explanation` | jsonb | ุงูุดุฑุญ | โ | - |
| `points` | integer | ุงูููุงุท | โ | `1` |
| `difficulty` | text | ูุณุชูู ุงูุตุนูุจุฉ | โ | `'medium'` |
| `tags` | text[] | ุงููุณูู | โ | - |
| `is_active` | boolean | ูู ูุดุท | โ | `true` |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
quiz_questions.lesson_id โ lessons.id (optional)
quiz_questions.created_by โ profiles.id
```

---

## 3. ุฌุฏูู `teacher_exams` - ุงูุชุญุงูุงุช ุงููุฏุฑุณ

### ุงููุตู
ุงูุงูุชุญุงูุงุช ุงูุชู ููุดุฆูุง ุงููุฏุฑุณูู ูุทูุงุจูู

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `exam_title` | text | ุนููุงู ุงูุงูุชุญุงู | โ | - |
| `exam_description` | text | ูุตู ุงูุงูุชุญุงู | โ | - |
| `stage_id` | uuid | ูุนุฑู ุงููุฑุญูุฉ | โ | - |
| `stage_name` | text | ุงุณู ุงููุฑุญูุฉ (cached) | โ | - |
| `subject_id` | uuid | ูุนุฑู ุงููุงุฏุฉ | โ | - |
| `subject_name` | text | ุงุณู ุงููุงุฏุฉ (cached) | โ | - |
| `teacher_id` | uuid | ูุนุฑู ุงููุฏุฑุณ | โ | - |
| `sections` | jsonb | ุฃูุณุงู ุงูุงูุชุญุงู | โ | `'[]'` |
| `settings` | jsonb | ุฅุนุฏุงุฏุงุช ุงูุงูุชุญุงู | โ | `'{}'` |
| `total_marks` | integer | ุงูุฏุฑุฌุฉ ุงููููุฉ | โ | - |
| `duration_minutes` | integer | ูุฏุฉ ุงูุงูุชุญุงู ุจุงูุฏูุงุฆู | โ | - |
| `is_published` | boolean | ูู ููุดูุฑ | โ | `false` |
| `start_date` | timestamptz | ุชุงุฑูุฎ ุงูุจุฏุงูุฉ | โ | - |
| `end_date` | timestamptz | ุชุงุฑูุฎ ุงูููุงูุฉ | โ | - |
| `allow_retake` | boolean | ุงูุณูุงุญ ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ | โ | `false` |
| `max_attempts` | integer | ุงูุญุฏ ุงูุฃูุตู ูููุญุงููุงุช | โ | `1` |
| `shuffle_questions` | boolean | ุฎูุท ุงูุฃุณุฆูุฉ | โ | `false` |
| `shuffle_options` | boolean | ุฎูุท ุงูุฎูุงุฑุงุช | โ | `false` |
| `show_results` | boolean | ุนุฑุถ ุงููุชุงุฆุฌ | โ | `true` |
| `show_correct_answers` | boolean | ุนุฑุถ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ | โ | `true` |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
teacher_exams.stage_id โ educational_stages.id
teacher_exams.subject_id โ subjects.id
teacher_exams.teacher_id โ profiles.id
```

### ูููู `sections` (JSONB)

```json
[
  {
    "id": "uuid",
    "title": { "ar": "ุงููุณู ุงูุฃูู", "en": "Section 1" },
    "description": { "ar": "", "en": "" },
    "questions": [
      {
        "id": "uuid",
        "type": "multiple_choice",
        "text": { "ar": "...", "en": "..." },
        "options": [...],
        "correctAnswer": "...",
        "points": 2
      }
    ]
  }
]
```

### ูููู `settings` (JSONB)

```json
{
  "passingScore": 50,
  "showTimer": true,
  "allowBack": true,
  "autoSubmit": true,
  "randomizeQuestions": false,
  "randomizeOptions": false
}
```

---

## 4. ุฌุฏูู `teacher_exam_attempts` - ูุญุงููุงุช ุงูุชุญุงูุงุช ุงููุฏุฑุณ

### ุงููุตู
ุชุณุฌูู ูุญุงููุงุช ุงูุทูุงุจ ูู ุงูุชุญุงูุงุช ุงููุฏุฑุณูู

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `exam_id` | uuid | ูุนุฑู ุงูุงูุชุญุงู | โ | - |
| `student_id` | uuid | ูุนุฑู ุงูุทุงูุจ | โ | - |
| `answers` | jsonb | ุฅุฌุงุจุงุช ุงูุทุงูุจ | โ | `'{}'` |
| `status` | text | ุญุงูุฉ ุงููุญุงููุฉ | โ | `'in_progress'` |
| `total_score` | integer | ุงูุฏุฑุฌุฉ ุงููููุฉ | โ | - |
| `max_score` | integer | ุฃูุตู ุฏุฑุฌุฉ ููููุฉ | โ | - |
| `percentage` | numeric | ุงููุณุจุฉ ุงููุฆููุฉ | โ | - |
| `started_at` | timestamptz | ููุช ุงูุจุฏุงูุฉ | โ | `now()` |
| `submitted_at` | timestamptz | ููุช ุงูุชุณููู | โ | - |
| `time_spent_seconds` | integer | ุงูููุช ุงููุณุชุบุฑู ุจุงูุซูุงูู | โ | - |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
teacher_exam_attempts.exam_id โ teacher_exams.id
teacher_exam_attempts.student_id โ profiles.id
```

### ูููู `answers` (JSONB)

```json
{
  "question_id_1": {
    "answer": "selected_option_id",
    "isCorrect": true,
    "points": 2,
    "answeredAt": "timestamp"
  },
  "question_id_2": {
    "answer": ["option1", "option2"],
    "isCorrect": false,
    "points": 0,
    "answeredAt": "timestamp"
  }
}
```

### ููู `status`

- `in_progress` - ููุฏ ุงูุชูุฏู
- `submitted` - ุชู ุงูุชุณููู
- `graded` - ุชู ุงูุชุตุญูุญ
- `expired` - ุงูุชูู ุงูููุช

---

## 5. ุฌุฏูู `comprehensive_exams` - ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ

### ุงููุตู
ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ ุงูุชู ููุดุฆูุง ุงูุฃุฏูู ูููููุน

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `exam_title` | text | ุนููุงู ุงูุงูุชุญุงู | โ | - |
| `exam_description` | text | ูุตู ุงูุงูุชุญุงู | โ | - |
| `stage_id` | uuid | ูุนุฑู ุงููุฑุญูุฉ | โ | - |
| `stage_name` | text | ุงุณู ุงููุฑุญูุฉ (cached) | โ | - |
| `subject_id` | uuid | ูุนุฑู ุงููุงุฏุฉ | โ | - |
| `subject_name` | text | ุงุณู ุงููุงุฏุฉ (cached) | โ | - |
| `sections` | jsonb | ุฃูุณุงู ุงูุงูุชุญุงู | โ | `'[]'` |
| `settings` | jsonb | ุฅุนุฏุงุฏุงุช ุงูุงูุชุญุงู | โ | `'{}'` |
| `total_marks` | integer | ุงูุฏุฑุฌุฉ ุงููููุฉ | โ | - |
| `duration_minutes` | integer | ูุฏุฉ ุงูุงูุชุญุงู ุจุงูุฏูุงุฆู | โ | - |
| `is_published` | boolean | ูู ููุดูุฑ | โ | `false` |
| `created_by` | uuid | ูุนุฑู ุงูููุดุฆ (ุฃุฏูู) | โ | - |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
comprehensive_exams.stage_id โ educational_stages.id
comprehensive_exams.subject_id โ subjects.id
comprehensive_exams.created_by โ profiles.id
```

---

## 6. ุฌุฏูู `comprehensive_exam_attempts` - ูุญุงููุงุช ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ

### ุงููุตู
ุชุณุฌูู ูุญุงููุงุช ุงูุทูุงุจ ูู ุงูุงูุชุญุงูุงุช ุงูุดุงููุฉ

### ุงูุญููู (Fields)

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุทููุจ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|-------|-------|-------|-------|-------------------|
| `id` | uuid | ุงููุนุฑู ุงููุฑูุฏ | โ | `gen_random_uuid()` |
| `exam_id` | uuid | ูุนุฑู ุงูุงูุชุญุงู | โ | - |
| `student_id` | uuid | ูุนุฑู ุงูุทุงูุจ | โ | - |
| `answers` | jsonb | ุฅุฌุงุจุงุช ุงูุทุงูุจ | โ | `'{}'` |
| `status` | text | ุญุงูุฉ ุงููุญุงููุฉ | โ | `'in_progress'` |
| `total_score` | integer | ุงูุฏุฑุฌุฉ ุงููููุฉ | โ | - |
| `max_score` | integer | ุฃูุตู ุฏุฑุฌุฉ ููููุฉ | โ | - |
| `percentage` | numeric | ุงููุณุจุฉ ุงููุฆููุฉ | โ | - |
| `started_at` | timestamptz | ููุช ุงูุจุฏุงูุฉ | โ | `now()` |
| `submitted_at` | timestamptz | ููุช ุงูุชุณููู | โ | - |
| `time_spent_seconds` | integer | ุงูููุช ุงููุณุชุบุฑู ุจุงูุซูุงูู | โ | - |
| `created_at` | timestamptz | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ | `now()` |
| `updated_at` | timestamptz | ุชุงุฑูุฎ ุงูุชุญุฏูุซ | โ | `now()` |

### ุงูุนูุงูุงุช (Relationships)

```
comprehensive_exam_attempts.exam_id โ comprehensive_exams.id
comprehensive_exam_attempts.student_id โ profiles.id
```

---

## ๐ ูุฎุทุท ุงูุนูุงูุงุช (ERD)

```
โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
โ   educational_      โ     โ      subjects        โ
โ      stages         โ     โ                      โ
โโโโโโโโโโโฌโโโโโโโโโโโโ     โโโโโโโโโโโโฌโโโโโโโโโโโโ
          โ                            โ
          โ stage_id                   โ subject_id
          โผ                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    question_banks                    โ
โ  id, lesson_id, stage_id, subject_id, sections      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ
          โ lesson_id
          โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ       lessons       โ
โโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ
โ    quiz_questions   โ     โ       profiles       โ
โ   (standalone or    โโโโโโถโ      (students,      โ
โ    lesson-linked)   โ     โ    teachers, admins) โ
โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   teacher_exams     โโโโโโถโ  teacher_exam_attempts   โ
โ  (created by        โ     โ  (student answers)       โ
โ   teachers)         โ     โ                          โ
โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ comprehensive_exams โโโโโโถโ comprehensive_exam_attempts  โ
โ  (created by admins)โ     โ  (student answers)           โ
โโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุณูุงุณุงุช RLS (Row Level Security)

### question_banks
- **SELECT**: ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ูููููู ูุฑุงุกุฉ ุงูุจููู ุงูููุดูุฑุฉ
- **INSERT**: ุงููุฏุฑุณูู ูุงูุฃุฏูู ููุท
- **UPDATE**: ุงูููุดุฆ ุฃู ุงูุฃุฏูู ููุท
- **DELETE**: ุงูููุดุฆ ุฃู ุงูุฃุฏูู ููุท

### teacher_exams
- **SELECT**: ุงููุฏุฑุณ ุตุงุญุจ ุงูุงูุชุญุงู + ุงูุทูุงุจ (ููุงูุชุญุงูุงุช ุงูููุดูุฑุฉ)
- **INSERT**: ุงููุฏุฑุณูู ููุท
- **UPDATE**: ุงููุฏุฑุณ ุตุงุญุจ ุงูุงูุชุญุงู ููุท
- **DELETE**: ุงููุฏุฑุณ ุตุงุญุจ ุงูุงูุชุญุงู ููุท

### teacher_exam_attempts
- **SELECT**: ุงูุทุงูุจ ุตุงุญุจ ุงููุญุงููุฉ + ุงููุฏุฑุณ ุตุงุญุจ ุงูุงูุชุญุงู
- **INSERT**: ุงูุทูุงุจ ููุท
- **UPDATE**: ุงูุทุงูุจ (ุฃุซูุงุก ุงูุงูุชุญุงู) + ุงููุฏุฑุณ (ููุชุตุญูุญ)
- **DELETE**: ูุง ุฃุญุฏ (ููุญูุงุธ ุนูู ุงูุณุฌูุงุช)

### comprehensive_exams
- **SELECT**: ุงูุฌููุน (ููุงูุชุญุงูุงุช ุงูููุดูุฑุฉ)
- **INSERT**: ุงูุฃุฏูู ููุท
- **UPDATE**: ุงูุฃุฏูู ููุท
- **DELETE**: ุงูุฃุฏูู ููุท

### comprehensive_exam_attempts
- **SELECT**: ุงูุทุงูุจ ุตุงุญุจ ุงููุญุงููุฉ + ุงูุฃุฏูู
- **INSERT**: ุงูุทูุงุจ ููุท
- **UPDATE**: ุงูุทุงูุจ (ุฃุซูุงุก ุงูุงูุชุญุงู) + ุงูุฃุฏูู (ููุชุตุญูุญ)
- **DELETE**: ุงูุฃุฏูู ููุท

---

## ๐ ุฃููุงุน ุงูุฃุณุฆูุฉ ุงููุฏุนููุฉ

| ุงูููุน | ุงููุตู |
|-------|-------|
| `multiple_choice` | ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ |
| `true_false` | ุตุญ ุฃู ุฎุทุฃ |
| `fill_blank` | ููุก ุงููุฑุงุบุงุช |
| `matching` | ุงูุชูุตูู |
| `ordering` | ุงูุชุฑุชูุจ |
| `essay` | ููุงูู |
| `short_answer` | ุฅุฌุงุจุฉ ูุตูุฑุฉ |

---

## ๐ ุงูุฌุฏุงูู ุงููุณุงุนุฏุฉ

| ุงูุฌุฏูู | ุงููุตู |
|--------|-------|
| `lessons` | ุงูุฏุฑูุณ (ูุฑุชุจุทุฉ ุจุจูู ุงูุฃุณุฆูุฉ) |
| `subjects` | ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ |
| `educational_stages` | ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ |
| `profiles` | ุงููุณุชุฎุฏููู (ุทูุงุจ/ูุฏุฑุณูู/ุฃุฏูู) |

---

*ุชู ุฅูุดุงุก ูุฐุง ุงููุณุชูุฏ ุชููุงุฆูุงู ูู ุชุญููู `database_xray_output.json`*
