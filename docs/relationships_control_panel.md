# Ø¯Ù„ÙŠÙ„ Ø¬Ø¯Ø§ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ ÙˆØ§Ù„Ø­Ø§Ù„Ø© (Audit)

Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙŠÙˆØ¶Ø­ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© "Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ø§Ù…Ù„Ø©" Ø¹Ù† Ø­Ø§Ù„Ø© ÙƒÙ„ Ø¬Ø¯ÙˆÙ„: Ù‡Ù„ Ù‡Ùˆ Ù…Ø³ØªØ®Ø¯Ù… ÙØ¹Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ØŸ ÙˆØ£ÙŠÙ†ØŸ ÙˆÙ…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©ØŸ

---

## 1. ØªØ¸Ù„ÙŠÙ„ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (`user_word_highlights`)
**Ø§Ù„Ø­Ø§Ù„Ø©: Ù†Ø´Ø· ÙˆÙ…Ø³ØªØ®Ø¯Ù… ðŸŸ¢**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ®Ø²Ù† "Ø£ÙƒØ´Ù†" Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø°ÙŠ ÙŠÙˆÙ… Ø¨Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨.
- **Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ÙƒÙˆØ¯**:
  - `app/api/words/highlight/route.ts`: Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.
  - `toggle_word_highlight_v2` (Database Function): Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
- **ØªÙˆØ¶ÙŠØ­ Ù‡Ø§Ù…**:
  - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØ§Ù† Ù…Ø­Ù‚Ø§Ù‹: Ø§Ù„ØªØ¸Ù„ÙŠÙ„ ÙŠØªØ®Ø²Ù† Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©. Ø§Ù„Ø¨Ù†ÙŠØ© Ù‡ÙŠ `JSONB` Ù…Ø±Ù†Ø© Ø¬Ø¯Ø§Ù‹.
  - **Ù…Ù„Ø§Ø­Ø¸Ø©**: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‡Ùˆ "Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø­ÙŠ" Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø¹ Ø§Ù„Ù†ØµÙˆØµ.

---

## 2. Ø¨Ù†Ùƒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª (`word_bank`)
**Ø§Ù„Ø­Ø§Ù„Ø©: Ù†Ø´Ø· ÙˆÙ…Ø³ØªØ®Ø¯Ù… ðŸŸ¢**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ù…Ø®Ø²Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± ÙÙŠ ØµÙØ­Ø© "ÙƒÙ„Ù…Ø§ØªÙŠ" Ø£Ùˆ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³.
- **Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ÙƒÙˆØ¯**:
  - `app/words/page.tsx`: ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨.
  - `app/admin/word-bank/page.tsx`: Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.
  - `app/api/words/word-bank/route.ts`: Ø§Ù„Ù€ API Ø§Ù„Ø°ÙŠ ÙŠØ¬Ù„Ø¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª.

---

## 3. ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµÙØ­Ø§Øª (`page_words`)
**Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ± ÙˆØ§Ø¶Ø­ / Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥Ø¯Ø§Ø±ÙŠ ÙÙ‚Ø· âš ï¸**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ø¬Ø¯ÙˆÙ„ Ù„ØªØ®Ø²ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù„Ø¬Ø¹Ù„Ù‡ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±.
- **Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ÙƒÙˆØ¯**:
  - `app/admin/page-words/page.tsx`: Ù…ÙˆØ¬ÙˆØ¯ ÙÙ‚Ø· ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†.
  - **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©**: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¶Ø­ Ù„Ù‡ ÙÙŠ "ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³" Ø£Ùˆ Ø§Ù„Ù€ "Reader" Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„ÙƒÙˆØ¯.
  - **Ø§Ù„ØªØ­Ù„ÙŠÙ„**: ØºØ§Ù„Ø¨Ø§Ù‹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ¸Ù„ÙŠÙ„ Ø­Ø± (Ø£ÙŠ ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ù†Øµ) ÙˆØªØ±Ø³Ù„Ù‡Ø§ Ù„Ù„Ù€ APIØŒ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„ØªØ­Ù‚Ù‚ØŒ Ù…Ù…Ø§ ÙŠØ¬Ø¹Ù„Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹ "Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±ÙŠ" Ø£Ùˆ "Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© Ø§Ù„Ø±Ø¨Ø·".

---

## 4. Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© (`supported_languages`)
**Ø§Ù„Ø­Ø§Ù„Ø©: Ù†Ø´Ø· (Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ©) ðŸ”µ**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª (En, Ar, Fr...).
- **Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…**:
  - ÙŠØ³ØªØ®Ø¯Ù… ÙƒÙ…Ø±Ø¬Ø¹ (Foreign Key) ÙÙŠ ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† ØµØ­Ø© ÙƒÙˆØ¯ Ø§Ù„Ù„ØºØ©.

---

## 5. ØªØ±Ø¬Ù…Ø§Øª Ø¨Ù†Ùƒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª (`word_bank_translations`)
**Ø§Ù„Ø­Ø§Ù„Ø©: Ù†Ø´Ø· ÙˆÙ…Ø³ØªØ®Ø¯Ù… ðŸŸ¢**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ø¬Ø¯ÙˆÙ„ ÙØ±Ø¹ÙŠ Ù„ØªØ±Ø¬Ù…Ø© ÙƒÙ„Ù…Ø§Øª `word_bank`.
- **Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…**:
  - ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ø¹ `word_bank` ÙÙŠ `app/api/words/word-bank/route.ts`.

---

## 6. Ù…Ø®Ø²Ù† Ø§Ù„ØªØ±Ø¬Ù…Ø© (`translation_cache`)
**Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ± Ù…Ø¤ÙƒØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù…Ø³ÙˆØ­ âš ï¸**

- **Ù…Ø§ Ù‡Ø°Ø§ØŸ**: Ø¬Ø¯ÙˆÙ„ "ÙƒØ§Ø´" Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©.
- **Ø§Ù„ØªØ­Ù„ÙŠÙ„**: Ù„Ù… ÙŠØ¸Ù‡Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ ÙÙŠ Ù…Ù„ÙØ§Øª Ø§Ù„Ù€ TypeScript Ø§Ù„ØªÙŠ ØªÙ… ÙØ­ØµÙ‡Ø§ØŒ ÙˆÙ„ÙƒÙ†Ù‡ Ù‚Ø¯ ÙŠØ³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± Database Functions (Ù…Ø«Ù„ `get_cached_translation`) Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù€ Supabase ClientØŒ Ø£Ùˆ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙŠØ²Ø© Ù…Ø®Ø·Ø· Ù„Ù‡Ø§ Ù„Ù… ØªÙØ¹Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯.

---

## Ø§Ù„Ø®Ù„Ø§ØµØ© Ù„Ù„Ù…Ø·ÙˆØ± (The Spaghetti Reality ðŸ):

1. **Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¸Ù„ÙŠÙ„ (Highlighting)**: ÙŠØ¹ØªÙ…Ø¯ ÙƒÙ„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ `user_word_highlights` ÙˆØ¨Ù†ÙŠØ© JSON Ø¯Ø§Ø®Ù„Ù‡. Ø¬Ø¯ÙˆÙ„ `page_words` ÙŠØ¨Ø¯Ùˆ Ù…Ø¹Ø²ÙˆÙ„Ø§Ù‹ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙˆÙ„Ø§ ÙŠØªØ¯Ø®Ù„ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø­ÙŠØ© (ÙˆÙ‡Ø°Ø§ ÙŠÙØ³Ø± Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ø£Ù† Ø§Ù„ØªØ¸Ù„ÙŠÙ„ ÙŠØªØ®Ø²Ù† ÙÙŠ Ø§Ù„Ù€ user highlights Ù…Ø¨Ø§Ø´Ø±Ø©).
2. **Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª (Vocabulary)**: Ù…Ø³ØªÙ‚Ø± ÙˆÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ `word_bank` Ùˆ `word_bank_translations`.
3. **Ø§Ù„ØªÙˆØµÙŠØ©**: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø£Ù† Ø§Ù„ØªØ¸Ù„ÙŠÙ„ ÙŠÙƒÙˆÙ† "Ø­Ø±" (Ø£ÙŠ ÙƒÙ„Ù…Ø©)ØŒ ÙØ¬Ø¯ÙˆÙ„ `page_words` Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø²Ø§Ø¦Ø¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ø£Ùˆ ÙŠØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¸ÙŠÙ (Ù…Ø«Ù„Ø§Ù‹ Ù„Ø§Ù‚ØªØ±Ø§Ø­ ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨).

---

## Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ (As-Is Architecture)

```mermaid
graph TD
    User[Student] -->|Highlights Text| API[Next.js API Route<br>/api/words/highlight]
    API -->|RPC Call| DB_Func[toggle_word_highlight_v2]
    DB_Func -->|Writes JSON| UserHighlights[Table: user_word_highlights]
    
    User -->|Views Vocabulary| WordsPage[Page: /words]
    WordsPage -->|Fetches| WordBank[Table: word_bank]
    WordBank -->|Joins| Translations[Table: word_bank_translations]
    
    Admin[Admin User] -->|Manages| PageWords[Table: page_words]
    PageWords -.->|No logic link found yet| UserHighlights
```
